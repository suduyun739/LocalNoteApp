# ğŸ› ï¸ æŠ€æœ¯æ–‡æ¡£

## é¡¹ç›®æ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ç”¨æˆ·ç•Œé¢ (UI)                   â”‚
â”‚         index.html + styles.css             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          åº”ç”¨é€»è¾‘å±‚ (app.js)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ çŠ¶æ€ç®¡ç† (appState)                 â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ è§†å›¾æ§åˆ¶ (View Management)          â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ äº‹ä»¶å¤„ç† (Event Handlers)           â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ UI æ¸²æŸ“ (Rendering Functions)       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        æ•°æ®è®¿é—®å±‚ (db.js)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ NoteDatabase ç±»                     â”‚   â”‚
â”‚  â”‚ - init()                            â”‚   â”‚
â”‚  â”‚ - addNote()                         â”‚   â”‚
â”‚  â”‚ - updateNote()                      â”‚   â”‚
â”‚  â”‚ - deleteNote()                      â”‚   â”‚
â”‚  â”‚ - getNoteById()                     â”‚   â”‚
â”‚  â”‚ - getAllNotes()                     â”‚   â”‚
â”‚  â”‚ - searchNotes()                     â”‚   â”‚
â”‚  â”‚ - importNotes()                     â”‚   â”‚
â”‚  â”‚ - exportNotes()                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          IndexedDB (æµè§ˆå™¨)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Database: NoteAppDB                 â”‚   â”‚
â”‚  â”‚   Object Store: notes               â”‚   â”‚
â”‚  â”‚     - Primary Key: id               â”‚   â”‚
â”‚  â”‚     - Index: type                   â”‚   â”‚
â”‚  â”‚     - Index: date                   â”‚   â”‚
â”‚  â”‚     - Index: lastModified           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ æ–‡ä»¶è¯´æ˜

### index.html
**èŒè´£**ï¼šHTML ç»“æ„å’Œ DOM å…ƒç´ 

**å…³é”®éƒ¨åˆ†**ï¼š
```html
<!-- è§†å›¾å®¹å™¨ -->
<div id="listView" class="view active">     <!-- åˆ—è¡¨è§†å›¾ -->
<div id="detailView" class="view">          <!-- è¯¦æƒ…è§†å›¾ -->
<div id="formView" class="view">            <!-- è¡¨å•è§†å›¾ -->

<!-- æ¨¡æ€æ¡† -->
<div id="confirmModal" class="modal">       <!-- ç¡®è®¤å¯¹è¯æ¡† -->
<div id="toast" class="toast">              <!-- é€šçŸ¥æç¤º -->
```

**è§†å›¾åˆ‡æ¢æœºåˆ¶**ï¼š
- ä¸‰ä¸ªä¸»è§†å›¾é€šè¿‡ `.active` ç±»æ§åˆ¶æ˜¾ç¤º
- åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªè§†å›¾æ˜¾ç¤º
- ä½¿ç”¨ CSS åŠ¨ç”»å®ç°å¹³æ»‘è¿‡æ¸¡

### styles.css
**èŒè´£**ï¼šæ ·å¼å’Œå¸ƒå±€

**CSS æ¶æ„**ï¼š
```css
:root {
    /* CSS å˜é‡å®šä¹‰ */
    --primary-color: #2563eb;
    --spacing-md: 1rem;
    /* ... */
}

/* åŸºç¡€æ ·å¼ */
* { box-sizing: border-box; }

/* å¸ƒå±€ */
.app-container { /* Grid å¸ƒå±€ */ }
.main-content { /* Flexbox å¸ƒå±€ */ }

/* ç»„ä»¶æ ·å¼ */
.note-card { /* ç¬”è®°å¡ç‰‡ */ }
.modal { /* æ¨¡æ€æ¡† */ }
/* ... */

/* å“åº”å¼ */
@media (max-width: 768px) { /* ç§»åŠ¨ç«¯é€‚é… */ }
```

**å…³é”®æŠ€æœ¯**ï¼š
- **CSS Grid**ï¼šä¸»å¸ƒå±€ï¼ˆä¾§è¾¹æ  + å†…å®¹åŒºï¼‰
- **Flexbox**ï¼šç»„ä»¶å†…éƒ¨å¸ƒå±€
- **CSS å˜é‡**ï¼šä¸»é¢˜å’Œé¢œè‰²ç®¡ç†
- **åŠ¨ç”»**ï¼šè¿‡æ¸¡æ•ˆæœå’Œå¾®äº¤äº’

### db.js
**èŒè´£**ï¼šæ•°æ®åº“æ“ä½œå°è£…

**ç±»ç»“æ„**ï¼š
```javascript
class NoteDatabase {
    constructor() {
        this.db = null;  // IndexedDB è¿æ¥
    }

    async init() { /* åˆå§‹åŒ–æ•°æ®åº“ */ }

    // CRUD æ“ä½œ
    async addNote(note) { /* æ·»åŠ  */ }
    async updateNote(note) { /* æ›´æ–° */ }
    async deleteNote(id) { /* åˆ é™¤ */ }
    async getNoteById(id) { /* æŸ¥è¯¢å•ä¸ª */ }
    async getAllNotes() { /* æŸ¥è¯¢å…¨éƒ¨ */ }
    async getNotesByType(type) { /* æŒ‰ç±»å‹æŸ¥è¯¢ */ }

    // é«˜çº§åŠŸèƒ½
    async searchNotes(keyword) { /* æœç´¢ */ }
    async importNotes(notes) { /* å¯¼å…¥ */ }
    async clearAll() { /* æ¸…ç©º */ }
    async getStats() { /* ç»Ÿè®¡ */ }
}
```

**Promise å°è£…æ¨¡å¼**ï¼š
```javascript
async addNote(note) {
    return new Promise((resolve, reject) => {
        const transaction = this.db.transaction([STORE_NAME], 'readwrite');
        const objectStore = transaction.objectStore(STORE_NAME);
        const request = objectStore.add(note);

        request.onsuccess = () => resolve(note.id);
        request.onerror = (event) => reject(event.target.error);
    });
}
```

### app.js
**èŒè´£**ï¼šåº”ç”¨é€»è¾‘å’Œ UI æ§åˆ¶

**ä¸»è¦éƒ¨åˆ†**ï¼š

1. **çŠ¶æ€ç®¡ç†**
```javascript
const appState = {
    currentView: 'list',        // å½“å‰è§†å›¾
    currentFilter: 'all',       // ç­›é€‰æ¡ä»¶
    currentNoteId: null,        // å½“å‰ç¬”è®° ID
    isEditMode: false,          // ç¼–è¾‘æ¨¡å¼
    searchKeyword: '',          // æœç´¢å…³é”®è¯
    sortBy: 'date-desc'         // æ’åºæ–¹å¼
};
```

2. **è§†å›¾åˆ‡æ¢**
```javascript
function switchView(viewName) {
    // éšè—æ‰€æœ‰è§†å›¾
    document.querySelectorAll('.view').forEach(view => {
        view.classList.remove('active');
    });
    // æ˜¾ç¤ºç›®æ ‡è§†å›¾
    document.getElementById(`${viewName}View`).classList.add('active');
    appState.currentView = viewName;
}
```

3. **æ•°æ®æµ**
```javascript
åŠ è½½æ•°æ® â†’ è¿‡æ»¤/æœç´¢ â†’ æ’åº â†’ æ¸²æŸ“ UI
  â†“
noteDB.getAllNotes()
  â†“
filter by type/search
  â†“
sortNotes()
  â†“
renderNotesList()
```

---

## ğŸ—ƒï¸ IndexedDB è¯¦è§£

### æ•°æ®åº“ç»“æ„

```
Database: NoteAppDB (version 1)
  â”‚
  â””â”€ Object Store: notes
       â”‚
       â”œâ”€ Key Path: id (ä¸»é”®)
       â”‚
       â”œâ”€ Indexes:
       â”‚    â”œâ”€ type (ç”¨äºç±»å‹ç­›é€‰)
       â”‚    â”œâ”€ date (ç”¨äºæ—¥æœŸæ’åº)
       â”‚    â””â”€ lastModified (ç”¨äºä¿®æ”¹æ—¶é—´æ’åº)
       â”‚
       â””â”€ Records:
            â”œâ”€ { id, type, title, content, ... }
            â”œâ”€ { id, type, title, content, ... }
            â””â”€ ...
```

### ç´¢å¼•çš„ä½œç”¨

**æ²¡æœ‰ç´¢å¼•çš„æŸ¥è¯¢**ï¼š
```javascript
// éœ€è¦éå†æ‰€æœ‰è®°å½• O(n)
async getNotesByType(type) {
    const allNotes = await this.getAllNotes();
    return allNotes.filter(note => note.type === type);
}
```

**ä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢**ï¼š
```javascript
// ç›´æ¥å®šä½ O(log n)
async getNotesByType(type) {
    const index = objectStore.index('type');
    return index.getAll(type);  // æ›´å¿«ï¼
}
```

### äº‹åŠ¡æœºåˆ¶

```javascript
// 1. å¼€å¯äº‹åŠ¡
const transaction = db.transaction([STORE_NAME], 'readwrite');

// 2. è·å–å¯¹è±¡å­˜å‚¨
const objectStore = transaction.objectStore(STORE_NAME);

// 3. æ‰§è¡Œæ“ä½œ
const request = objectStore.add(note);

// 4. å¤„ç†ç»“æœ
request.onsuccess = () => { /* æˆåŠŸ */ };
request.onerror = () => { /* å¤±è´¥ */ };
```

**äº‹åŠ¡ç±»å‹**ï¼š
- `readonly`ï¼šåªè¯»ï¼Œå¯å¹¶å‘
- `readwrite`ï¼šè¯»å†™ï¼Œäº’æ–¥
- `versionchange`ï¼šå‡çº§æ•°æ®åº“

---

## ğŸ¨ UI æ¸²æŸ“æµç¨‹

### åˆ—è¡¨æ¸²æŸ“

```javascript
async loadNotesList() {
    // 1. è·å–æ•°æ®
    let notes = await noteDB.getAllNotes();

    // 2. è¿‡æ»¤
    if (appState.currentFilter !== 'all') {
        notes = await noteDB.getNotesByType(appState.currentFilter);
    }

    // 3. æœç´¢
    if (appState.searchKeyword) {
        notes = notes.filter(/* æœç´¢é€»è¾‘ */);
    }

    // 4. æ’åº
    notes = sortNotes(notes, appState.sortBy);

    // 5. æ¸²æŸ“
    renderNotesList(notes);
}

function renderNotesList(notes) {
    // 6. ç”Ÿæˆ HTML
    const html = notes.map(note => `
        <div class="note-card" onclick="viewNoteDetail('${note.id}')">
            <!-- ç¬”è®°å¡ç‰‡å†…å®¹ -->
        </div>
    `).join('');

    // 7. æ›´æ–° DOM
    document.getElementById('notesList').innerHTML = html;
}
```

### åŠ¨æ€å­—æ®µæ˜¾ç¤º

```javascript
function showTypeSpecificFields(type) {
    // éšè—æ‰€æœ‰ç±»å‹ç‰¹å®šå­—æ®µ
    document.querySelectorAll('.type-specific-fields').forEach(field => {
        field.style.display = 'none';
    });

    // æ˜¾ç¤ºå¯¹åº”ç±»å‹çš„å­—æ®µ
    const fieldsMap = {
        book: 'bookFields',
        movie: 'movieFields',
        daily: 'dailyFields'
    };

    const fieldsId = fieldsMap[type];
    document.getElementById(fieldsId).style.display = 'block';

    // æ›´æ–°å¿…å¡«å­—æ®µ
    updateRequiredFields(type);
}
```

---

## ğŸ”„ æ•°æ®æµè¯¦è§£

### æ·»åŠ ç¬”è®°æµç¨‹

```
ç”¨æˆ·å¡«å†™è¡¨å•
    â†“
æäº¤è¡¨å• (submit event)
    â†“
saveNote(event)
    â†“
æ„å»ºç¬”è®°å¯¹è±¡
    â†“
æ ¹æ®ç±»å‹æ·»åŠ ç‰¹å®šå­—æ®µ
    â†“
noteDB.addNote(note)
    â†“
IndexedDB å­˜å‚¨
    â†“
è¿”å›æˆåŠŸ
    â†“
showToast('æ·»åŠ æˆåŠŸ')
    â†“
switchView('list')
    â†“
loadNotesList()
```

### æœç´¢æµç¨‹

```
ç”¨æˆ·è¾“å…¥å…³é”®è¯
    â†“
input event
    â†“
appState.searchKeyword = value
    â†“
loadNotesList()
    â†“
getAllNotes()
    â†“
filter(note => {
    titleMatch || contentMatch || tagsMatch
})
    â†“
renderNotesList(filteredNotes)
```

### ç¼–è¾‘ç¬”è®°æµç¨‹

```
ç”¨æˆ·ç‚¹å‡»ç¼–è¾‘æŒ‰é’®
    â†“
showEditNoteForm()
    â†“
noteDB.getNoteById(id)
    â†“
å¡«å……è¡¨å•æ•°æ®
    â†“
ç”¨æˆ·ä¿®æ”¹å†…å®¹
    â†“
æäº¤è¡¨å•
    â†“
noteDB.updateNote(note)
    â†“
æ›´æ–° lastModified æ—¶é—´æˆ³
    â†“
IndexedDB æ›´æ–°
    â†“
è¿”å›è¯¦æƒ…é¡µ
```

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### 1. IndexedDB ä¼˜åŒ–

**ä½¿ç”¨ç´¢å¼•åŠ é€ŸæŸ¥è¯¢**ï¼š
```javascript
// âŒ æ…¢ï¼šéå†æ‰€æœ‰æ•°æ®
const allNotes = await getAllNotes();
const bookNotes = allNotes.filter(n => n.type === 'book');

// âœ… å¿«ï¼šä½¿ç”¨ç´¢å¼•
const index = objectStore.index('type');
const bookNotes = await index.getAll('book');
```

**æ‰¹é‡æ“ä½œä½¿ç”¨äº‹åŠ¡**ï¼š
```javascript
// âœ… å¥½ï¼šä¸€ä¸ªäº‹åŠ¡å¤„ç†å¤šä¸ªæ“ä½œ
const transaction = db.transaction([STORE_NAME], 'readwrite');
const objectStore = transaction.objectStore(STORE_NAME);

for (const note of notes) {
    objectStore.add(note);
}

// ç­‰å¾…äº‹åŠ¡å®Œæˆ
await new Promise((resolve, reject) => {
    transaction.oncomplete = resolve;
    transaction.onerror = reject;
});
```

### 2. DOM æ“ä½œä¼˜åŒ–

**ä½¿ç”¨æ–‡æ¡£ç‰‡æ®µ**ï¼ˆå½“å‰å®ç°å¯æ”¹è¿›ï¼‰ï¼š
```javascript
// å½“å‰å®ç°
notesList.innerHTML = notes.map(/* ... */).join('');

// ä¼˜åŒ–æ–¹æ¡ˆï¼ˆå¤§é‡æ•°æ®æ—¶ï¼‰
const fragment = document.createDocumentFragment();
notes.forEach(note => {
    const card = document.createElement('div');
    card.innerHTML = /* ... */;
    fragment.appendChild(card);
});
notesList.appendChild(fragment);
```

**è™šæ‹Ÿæ»šåŠ¨**ï¼ˆå¤§é‡ç¬”è®°æ—¶ï¼‰ï¼š
```javascript
// åªæ¸²æŸ“å¯è§åŒºåŸŸçš„ç¬”è®°
// å¯ä»¥ä½¿ç”¨ Intersection Observer API
```

### 3. æœç´¢ä¼˜åŒ–

**é˜²æŠ–å¤„ç†**ï¼ˆå‡å°‘æœç´¢é¢‘ç‡ï¼‰ï¼š
```javascript
let searchTimeout;
searchInput.addEventListener('input', (e) => {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => {
        appState.searchKeyword = e.target.value;
        loadNotesList();
    }, 300);  // 300ms é˜²æŠ–
});
```

---

## ğŸ”’ å®‰å…¨è€ƒè™‘

### XSS é˜²æŠ¤

**HTML è½¬ä¹‰**ï¼š
```javascript
function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// ä½¿ç”¨
`<h3>${escapeHtml(note.title)}</h3>`
```

**ä¸ºä»€ä¹ˆéœ€è¦è½¬ä¹‰**ï¼š
```javascript
// æ¶æ„è¾“å…¥
const title = '<img src=x onerror=alert("XSS")>';

// âŒ ä¸è½¬ä¹‰ï¼šä¼šæ‰§è¡Œè„šæœ¬
innerHTML = `<h3>${title}</h3>`;

// âœ… è½¬ä¹‰ï¼šæ˜¾ç¤ºä¸ºæ–‡æœ¬
innerHTML = `<h3>${escapeHtml(title)}</h3>`;
// ç»“æœï¼š<h3>&lt;img src=x onerror=alert("XSS")&gt;</h3>
```

### æ•°æ®éªŒè¯

**è¡¨å•éªŒè¯**ï¼š
```html
<!-- HTML5 åŸç”ŸéªŒè¯ -->
<input type="text" required>
<input type="number" min="1" max="5">
<input type="date">
```

```javascript
// JavaScript é¢å¤–éªŒè¯
function saveNote(event) {
    event.preventDefault();

    if (title.trim().length === 0) {
        showToast('æ ‡é¢˜ä¸èƒ½ä¸ºç©º', 'error');
        return;
    }

    // ...
}
```

---

## ğŸ§© æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°çš„ç¬”è®°ç±»å‹

**1. å®šä¹‰ç±»å‹é…ç½®**ï¼ˆapp.jsï¼‰ï¼š
```javascript
const NOTE_TYPES = {
    book: { /* ... */ },
    movie: { /* ... */ },
    daily: { /* ... */ },
    travel: {  // æ–°å¢
        name: 'æ—…è¡Œç¬”è®°',
        icon: 'âœˆï¸',
        color: '#8B5CF6'
    }
};
```

**2. æ·»åŠ è¡¨å•å­—æ®µ**ï¼ˆindex.htmlï¼‰ï¼š
```html
<div id="travelFields" class="type-specific-fields" style="display: none;">
    <div class="form-group">
        <label>ç›®çš„åœ°</label>
        <input type="text" id="destination">
    </div>
    <!-- æ›´å¤šå­—æ®µ -->
</div>
```

**3. æ›´æ–°å­—æ®µæ˜¾ç¤ºé€»è¾‘**ï¼ˆapp.jsï¼‰ï¼š
```javascript
const fieldsMap = {
    book: 'bookFields',
    movie: 'movieFields',
    daily: 'dailyFields',
    travel: 'travelFields'  // æ–°å¢
};
```

### æ·»åŠ æ ‡ç­¾ç®¡ç†åŠŸèƒ½

**æ•°æ®åº“è®¾è®¡**ï¼š
```javascript
// åˆ›å»ºæ ‡ç­¾è¡¨
const tagStore = db.createObjectStore('tags', { keyPath: 'id' });

// åˆ›å»ºå…³è”è¡¨
const noteTagStore = db.createObjectStore('note_tags', {
    keyPath: ['noteId', 'tagId']
});
```

**æ ‡ç­¾å»ºè®®**ï¼š
```javascript
async getTagSuggestions() {
    const allNotes = await getAllNotes();
    const allTags = allNotes.flatMap(note => note.tags || []);
    const uniqueTags = [...new Set(allTags)];
    return uniqueTags.sort();
}
```

### æ·»åŠ å¯¼å‡ºä¸º Markdown

```javascript
async exportAsMarkdown() {
    const notes = await noteDB.getAllNotes();

    const markdown = notes.map(note => {
        const typeConfig = NOTE_TYPES[note.type];
        return `
# ${note.title}

**ç±»å‹**: ${typeConfig.icon} ${typeConfig.name}
**æ—¥æœŸ**: ${note.date}
${note.tags ? `**æ ‡ç­¾**: ${note.tags.join(', ')}` : ''}

## å†…å®¹

${note.content}

---
        `.trim();
    }).join('\n\n');

    // ä¸‹è½½
    const blob = new Blob([markdown], { type: 'text/markdown' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `notes-${new Date().toISOString().split('T')[0]}.md`;
    link.click();
    URL.revokeObjectURL(url);
}
```

---

## ğŸ› è°ƒè¯•æŠ€å·§

### Chrome DevTools

**æŸ¥çœ‹ IndexedDB**ï¼š
1. æ‰“å¼€ DevToolsï¼ˆF12ï¼‰
2. Application æ ‡ç­¾
3. Storage â†’ IndexedDB â†’ NoteAppDB
4. æŸ¥çœ‹æ‰€æœ‰æ•°æ®

**æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—**ï¼š
```javascript
// æ·»åŠ è°ƒè¯•æ—¥å¿—
console.log('âœ… ç¬”è®°æ·»åŠ æˆåŠŸ:', note);
console.error('âŒ é”™è¯¯:', error);
```

**æ–­ç‚¹è°ƒè¯•**ï¼š
```javascript
function saveNote(event) {
    debugger;  // æ–­ç‚¹
    // ...
}
```

### å¸¸è§é”™è¯¯

**1. QuotaExceededError**
```javascript
// åŸå› ï¼šå­˜å‚¨ç©ºé—´ä¸è¶³
// è§£å†³ï¼šæ¸…ç†æ—§æ•°æ®æˆ–å¢åŠ é…é¢

try {
    await noteDB.addNote(note);
} catch (error) {
    if (error.name === 'QuotaExceededError') {
        alert('å­˜å‚¨ç©ºé—´ä¸è¶³ï¼Œè¯·åˆ é™¤ä¸€äº›ç¬”è®°');
    }
}
```

**2. InvalidStateError**
```javascript
// åŸå› ï¼šåœ¨é”™è¯¯çš„äº‹åŠ¡çŠ¶æ€ä¸‹æ“ä½œ
// è§£å†³ï¼šç¡®ä¿åœ¨äº‹åŠ¡æ¿€æ´»æ—¶æ“ä½œ

const transaction = db.transaction([STORE_NAME], 'readwrite');
const objectStore = transaction.objectStore(STORE_NAME);
// å¿…é¡»ç«‹å³ä½¿ç”¨ objectStoreï¼Œä¸èƒ½ await åå†ç”¨
```

**3. NotFoundError**
```javascript
// åŸå› ï¼šæ•°æ®ä¸å­˜åœ¨
// è§£å†³ï¼šæ£€æŸ¥ ID æ˜¯å¦æ­£ç¡®

const note = await noteDB.getNoteById(id);
if (!note) {
    console.warn('ç¬”è®°ä¸å­˜åœ¨:', id);
    return;
}
```

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### æ¨èæ€§èƒ½ç›®æ ‡

- **åˆå§‹åŠ è½½**: < 500ms
- **åˆ—è¡¨æ¸²æŸ“**: < 100ms (100 æ¡ç¬”è®°)
- **æœç´¢å“åº”**: < 50ms
- **ç¬”è®°ä¿å­˜**: < 100ms
- **è§†å›¾åˆ‡æ¢**: < 200ms

### æ€§èƒ½æµ‹è¯•

```javascript
// æµ‹è¯•åŠ è½½æ€§èƒ½
console.time('loadNotes');
await loadNotesList();
console.timeEnd('loadNotes');

// æµ‹è¯•æ•°æ®åº“æ“ä½œ
console.time('addNote');
await noteDB.addNote(note);
console.timeEnd('addNote');
```

---

## ğŸ“ å­¦ä¹ èµ„æº

### æ¨èé˜…è¯»

1. **IndexedDB**
   - [MDN: IndexedDB API](https://developer.mozilla.org/zh-CN/docs/Web/API/IndexedDB_API)
   - [Using IndexedDB](https://developer.mozilla.org/zh-CN/docs/Web/API/IndexedDB_API/Using_IndexedDB)

2. **JavaScript**
   - [Promise](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise)
   - [async/await](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/async_function)

3. **CSS**
   - [CSS Grid](https://css-tricks.com/snippets/css/complete-guide-grid/)
   - [Flexbox](https://css-tricks.com/snippets/css/a-guide-to-flexbox/)

---

**å¸Œæœ›è¿™ä»½æŠ€æœ¯æ–‡æ¡£èƒ½å¸®åŠ©ä½ æ·±å…¥ç†è§£é¡¹ç›®ï¼** ğŸš€
